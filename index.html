<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <title>ğŸ“¬ GPG åŠ å¯†ç•™è¨€ç®±</title>
  <style>
    body {
      font-family: 'Noto Sans TC', sans-serif;
      background: #f9f9f9;
      padding: 2rem;
      color: #333;
    }
    .box {
      max-width: 600px;
      margin: auto;
      background: white;
      padding: 2rem;
      border-radius: 10px;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
    }
    h1 { text-align: center; }
    textarea {
      width: 100%;
      height: 180px;
      margin-bottom: 1rem;
      font-family: monospace;
    }
    input[type="file"] {
      margin-bottom: 1rem;
    }
    button {
      background: #2980b9;
      color: white;
      border: none;
      padding: 0.8rem 1.2rem;
      border-radius: 5px;
      cursor: pointer;
    }
    .msg {
      margin-top: 1rem;
      color: green;
    }
  </style>
</head>
<body>
  <div class="box">
    <h1>ğŸ“¬ GPG åŠ å¯†ç•™è¨€ç®±</h1>
    <p>è«‹è²¼ä¸Šä½ çš„ GPG åŠ å¯†è¨Šæ¯æˆ–ä¸Šå‚³ <code>.asc</code> æª”æ¡ˆã€‚æˆ‘æœƒæ”¶åˆ°å¾Œä½¿ç”¨ç§é‘°è§£å¯†ã€‚</p>

    <textarea id="pgpText" placeholder="è«‹è²¼ä¸Š -----BEGIN PGP MESSAGE----- é–‹é ­çš„å¯†æ–‡..."></textarea>

    <p>æˆ–ä¸Šå‚³æª”æ¡ˆï¼š</p>
    <input type="file" id="pgpFile" accept=".asc">

    <button onclick="submitMessage()">é€å‡ºç•™è¨€</button>

    <p class="msg" id="result"></p>
  </div>

  <script>
    async function submitMessage() {
      const textarea = document.getElementById("pgpText");
      const fileInput = document.getElementById("pgpFile");
      const result = document.getElementById("result");

      let message = textarea.value.trim();

      // è‹¥æ²’è²¼æ–‡å­—ï¼Œè©¦è‘—è®€æª”æ¡ˆå…§å®¹
      if (!message && fileInput.files.length > 0) {
        const file = fileInput.files[0];
        message = await file.text();
      }

      // é©—è­‰è¨Šæ¯æ˜¯å¦ç‚º GPG æ ¼å¼
      if (!message.includes("-----BEGIN PGP MESSAGE-----")) {
        result.style.color = 'red';
        result.textContent = "è«‹è¼¸å…¥æœ‰æ•ˆçš„ GPG å¯†æ–‡æˆ–ä¸Šå‚³ .asc æª”æ¡ˆ";
        return;
      }

      const data = {
        message_type: fileInput.files.length > 0 ? "file" : "text",
        content: message
      };

      fetch("https://script.google.com/macros/s/AKfycby6h0Q0q8lG5X0U0AsgakFt9l9MMOVR-CyXOuAwoWEZ-B4zkK5OhuM5bSkBkltfTi0/exec", {
        method: "POST",
        body: JSON.stringify(data)
      })
      .then(res => res.text())
      .then(msg => {
        result.style.color = 'green';
        result.textContent = "ç•™è¨€å·²é€å‡ºï¼Œæ„Ÿè¬ä½ ï¼";
        textarea.value = "";
        fileInput.value = "";
      })
      .catch(err => {
        result.style.color = 'red';
        result.textContent = "å‚³é€å¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦ã€‚";
      });
    }
  </script>
</body>
</html>
